{% extends "base.html" %}
{% if logtype == 'All' %}
{% set dataurl = '/data/sessions/all' %}
{% elif logtype == 'BaitSessions' %}
{% set dataurl = '/data/sessions/bait_sessions' %}
{% elif logtype == 'Attacks' %}
{% set dataurl = '/data/sessions/attacks' %}
{% endif %}

{% block content %}
<h3>Logs - {{ logtype }} <a class="btn btn-info pull-right" href="{{ dataurl }}"><i
        class="icon-download-alt"></i> Export</a></h3>
<table id="logtable" class="table table-bordered datagrid">
    	<thead/>

		<tfoot>
		<tr>
			<th>
				<div class="datagrid-footer-left" style="display:none;">
					<div class="grid-controls">
						<span><span class="grid-start"></span> - <span class="grid-end"></span> of <span class="grid-count"></span></span>
						<select class="grid-pagesize"><option>5</option><option>20</option><option>50</option></select>
						<span>Per Page</span>
					</div>
				</div>
				<div class="datagrid-footer-right" style="display:none;">
					<div class="grid-pager">
						<button class="btn grid-prevpage"><i class="icon-chevron-left"></i></button>
						<span>Page</span>
						<div class="input-append dropdown combobox">
							<input class="span1" type="text">
						</div>
						<span>of <span class="grid-pages"></span></span>
						<button class="btn grid-nextpage"><i class="icon-chevron-right"></i></button>
					</div>
				</div>
			</th>
		</tr>
		</tfoot>
</table>

<script type="text/javascript">

$('#logtable').datagrid({
  dataSource: new GenericDataSource({
    columns: [{
      property: 'time',
      label: 'Time',
      sortable: true
    },{
      property: 'protocol',
      label: 'Protocol',
      sortable: true
    },{
      property: 'ip_address',
      label: 'Source IP',
      sortable: false
    },{
      property: 'classification',
      label: 'Classification',
      sortable: false
    }],
    url: '{{ dataurl }}',
    formatter: function(items) {
        $.each(items, function(index, item) {
        item.time = item.time + '<span style="visibility: hidden;" data-id="' + item.id + '"/>';
  });
}
  })
}).on('click', 'tbody > tr', (function() {
            var id = $(this).find('> td > span').attr('data-id');

            $('#sessionTranscriptTable').datagrid({
            dataSource: new GenericDataSource({
            columns: [{
              property: 'time',
              label: 'Time',
              sortable: true
            },{
              property: 'direction',
              label: 'Direction',
              sortable: true
            },{
              property: 'data',
              label: 'Data',
              sortable: false
            }],
            url: '/data/session/' + id + '/transcript'
          })
        });
        $('#transcriptmodal').modal('show');
        $('#sessionLogTable').datagrid('reload');
        }));

</script>

<div id="transcriptmodal" class="modal hide fade" tabindex="-1">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">x</button>
        <h2>Session Transcript</h2>
    </div>
<table id="sessionTranscriptTable" class="table table-bordered datagrid">
    	<thead/>
		<tfoot>
		<tr>
			<th>
				<div class="datagrid-footer-left" style="display:none;">
					<div class="grid-controls">
						<span><span class="grid-start"></span> - <span class="grid-end"></span> of <span class="grid-count"></span></span>
						<select class="grid-pagesize"><option>5</option><option>20</option><option>50</option></select>
						<span>Per Page</span>
					</div>
				</div>
				<div class="datagrid-footer-right" style="display:none;">
					<div class="grid-pager">
						<button class="btn grid-prevpage"><i class="icon-chevron-left"></i></button>
						<span>Page</span>
						<div class="input-append dropdown combobox">
							<input class="span1" type="text">
						</div>
						<span>of <span class="grid-pages"></span></span>
						<button class="btn grid-nextpage"><i class="icon-chevron-right"></i></button>
					</div>
				</div>
			</th>
		</tr>
		</tfoot>
</table>
    <div class="modal-footer">
        <button class="btn" data-dismiss="modal">Close</button>
    </div>
</div>


{% endblock content %}